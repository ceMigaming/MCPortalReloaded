package com.cemi.portalreloaded.packets;

public class MessageKeyEvent extends AbstractPacket {
    public int event;
    
    public PacketKeyMessageKeyEventEvent() {
    }
    
    public MessageKeyEvent(int integer) {
        this.event = integer;
    }
    
    public void writeTo(ByteBuf byteBuf) {
        byteBuf.writeInt(this.event);
    }
    
    public void readFrom(ByteBuf byteBuf) {
        this.event = byteBuf.readInt();
    }
    
    public void execute(Side side, EntityPlayer entityPlayer) {
        ItemStack itemStack4 = ItemHandler.getUsableDualHandedItem((EntityLivingBase)entityPlayer);
        boolean boolean5 = itemStack4.func_77973_b() == PortalGun.itemPortalGun;
        switch (this.event) {
            case 0:
            case 1:
            case 2: {
                if (boolean5) {
                    NBTTagCompound nBTTagCompound6 = itemStack4.func_77978_p();
                    if (nBTTagCompound6 == null) {
                        ItemPortalGun.setRandomNBTTags(itemStack4, entityPlayer);
                        nBTTagCompound6 = itemStack4.func_77978_p();
                    }
                    if (nBTTagCompound6 != null) {
                        HashSet<PortalInfo> hashSet7 = PortalGun.eventHandlerServer.getWorldSaveData(entityPlayer.field_70170_p.field_73011_w.getDimension()).portalList;
                        ArrayList<PortalInfo> arrayList8 = new ArrayList<PortalInfo>();
                        for (final PortalInfo info : hashSet7) {
                            if (info.uuid.equals(nBTTagCompound6.func_74779_i("uuid")) && info.channelName.equals(nBTTagCompound6.func_74779_i("channelName")) && (this.event == 0 || (this.event == 1 && info.isTypeA) || (this.event == 2 && !info.isTypeA))) {
                                arrayList8.add(info);
                            }
                        }
                        for (final PortalInfo info : arrayList8) {
                            PortalPlacement portalPlacement11 = info.getPortalPlacement(entityPlayer.field_70170_p);
                            if (portalPlacement11 != null) {
                                portalPlacement11.remove(BlockPos.field_177992_a);
                            }
                        }
                        EntityHelper.playSoundAtEntity((Entity)entityPlayer, SoundIndex.pg_wpn_portal_fizzler_shimmy, entityPlayer.func_184176_by(), 0.2f, 1.0f);
                    }
                    break;
                }
                break;
            }
            case 3:
            case 4: {
                if (!boolean5) {
                    break;
                }
                if (GrabHandler.hasHandlerType((EntityLivingBase)entityPlayer, Side.SERVER, (Class)PortalGunGrabHandler.class)) {
                    PortalGunHelper.tryGrab((EntityLivingBase)entityPlayer);
                    break;
                }
                PortalGunHelper.shootPortal((EntityLivingBase)entityPlayer, itemStack4, this.event == 3);
                break;
            }
            case 5: {
                if (!PortalGunHelper.tryGrab((EntityLivingBase)entityPlayer) && boolean5) {
                    EntityHelper.playSoundAtEntity((Entity)entityPlayer, SoundIndex.pg_object_use_failure, entityPlayer.func_184176_by(), 0.2f, 1.0f);
                    break;
                }
                break;
            }
        }
    }
    
    public Side receivingSide() {
        return Side.SERVER;
    }
}
